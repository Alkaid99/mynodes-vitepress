# MySQL 基本操作-DQL

DQL（Data Query Language）是数据查询语言，用来查询数据库中表的记录 （数据）：

|常用命令|简介|
|-|-|
|`SELECT`|用于从数据库中选择数据。|
|`WHERE`|用于过滤记录，只有满足指定条件的记录才会被包含在结果集中。|

**基本语法：**

```sql
SELECT [ ALL | DISTINCT ] <目标表达式 1> [<别名>],<目标表达式 2> [<别名>]...
FROM <表名或视图名> [<别名>],<表名或视图名> [<别名>]...
[ WHERE <条件表达式> ]
[ GROUP BY <字段> [ HAVING <条件表达式> ] ]
[ ORDER BY <字段> [ ASC | DESC ] ]
[ LIMIT <数字或字段> ];
```

|关键字|描述|
|-|-|
|`SELECT [ ALL | DISTINCT ]`|用于指定是否返回重复记录。`ALL`关键字表示返回所有记录，包括重复记录。它是默认行为，因此通常不需要指定。`DISTINCT`关键字表示只返回不同（唯一）的记录。如果查询结果中有多条重复记录，只会返回一条（去重）。|
|`FROM <表名或视图名> [<别名>]`|指定要从中检索数据的表或视图，可以使用别名为查询中的表或视图指定不同的名称。|
|`[ WHERE <条件表达式> ]`|此可选子句指定必须满足的条件才能将行包含在结果集中。|
|`[ GROUP BY <字段> [ HAVING <条件表达式> ] ]`|此可选子句按一个或多个列对行进行分组并计算聚合值，如 SUM、COUNT、AVG 等。可选的 HAVING 子句指定必须满足的条件才能将组包含在结果集中。|
|`[ ORDER BY <字段> [ ASC | DESC ] ]`|此可选子句指定结果集中的行应如何排序。您可以使用 ASC 表示升序，或使用 DESC 表示降序。|
|`[ LIMIT <数字或字段> ]`|此可选子句限制结果集中返回的行数。|

**简化版的语法：**

```sql
SELECT * | <列名> FROM <表名> WHERE <条件表达式>;
```

## 数据准备

创建数据库和表：

```sql
CREATE DATABASE IF NOT EXISTS school; -- 创建数据库
USE school; -- 进入库中
CREATE TABLE IF NOT EXISTS student_info( -- 创建学生信息表
    sid INT PRIMARY KEY AUTO_INCREMENT, -- 学号
    name VARCHAR(20), -- 名字
    gender VARCHAR(20), -- 性别
    birthday DATE, -- 出生日期
    address VARCHAR(20)-- 地址
)AUTO_INCREMENT = 1001;
```

插入数据：

```sql
INSERT INTO student_info VALUES(NULL,'张三','男','2000-12-13','上海');
INSERT INTO student_info VALUES(NULL,'李四','女','2001-09-23','北京');
INSERT INTO student_info VALUES(NULL,'王五','男','2005-11-11','广州');
INSERT INTO student_info VALUES(NULL,'赵六',NULL,'2004-06-16',NULL);

INSERT INTO student_info VALUES(NULL,'小明','女','1999-03-03','广州');
INSERT INTO student_info VALUES(NULL,'小红','女','2006-03-03','深圳');
INSERT INTO student_info VALUES(NULL,'小蓝',NULL,'2003-04-28',NULL);
INSERT INTO student_info VALUES(NULL,'小绿','男','2008-12-21','深圳');

INSERT INTO student_info VALUES(NULL,'沈剑心',NULL,'700-02-02','纯阳');
INSERT INTO student_info VALUES(NULL,'李忘生','男','700-02-02',NULL);
INSERT INTO student_info VALUES(NULL,'谢云流','男',NULL,NULL);
```

## 简单查询

在 MySQL 中，可以使用`SELECT`语句来查询数据，简单查询就是不需要加上条件，作为基本的查询。

**参考示例：**

1. 查看表中所有数据

    如果想选取所有的列，那么可以使用`*`代替所有列名

    ```sql
    SELECT * FROM student_info;
    ```

    ```sql
    +------+-----------+--------+------------+-----------+
    | sid  | name      | gender | birthday   | address   |
    +------+-----------+--------+------------+-----------+
    | 1001 | 张三      | 男     | 2000-12-13 | 上海      |
    | 1002 | 李四      | 女     | 2001-09-23 | 北京      |
    | 1003 | 王五      | 男     | 2005-11-11 | 广州      |
    | 1004 | 赵六      | NULL   | 2004-06-16 | NULL      |
    | 1005 | 小明      | 女     | 1999-03-03 | 广州      |
    | 1006 | 小红      | 女     | 2006-03-03 | 深圳      |
    | 1007 | 小蓝      | NULL   | 2003-04-28 | NULL      |
    | 1008 | 小绿      | 男     | 2008-12-21 | 深圳      |
    | 1009 | 沈剑心    | NULL   | 0700-02-02 | 稻香村    |
    | 1010 | 李忘生    | 男     | 0700-02-02 | NULL      |
    | 1011 | 谢云流    | 男     | NULL       | NULL      |
    +------+-----------+--------+------------+-----------+
    ```

2. 选择指定的列查看

    ```sql
    SELECT sid,name FROM student_info;
    ```

    ```sql
    +------+-----------+
    | sid  | name      |
    +------+-----------+
    | 1001 | 张三      |
    | 1002 | 李四      |
    | 1003 | 王五      |
    | 1004 | 赵六      |
    | 1005 | 小明      |
    | 1006 | 小红      |
    | 1007 | 小蓝      |
    | 1008 | 小绿      |
    | 1009 | 沈剑心    |
    | 1010 | 李忘生    |
    | 1011 | 谢云流    |
    +------+-----------+
    ```

## 别名查询

MySQL `AS` 关键字用于为表或字段起一个临时的别名。别名是临时的，它仅在当前 SQL 语句中奏效，数据库中的实际表名和字段名不会更改。

别名通常用于以下情况：

- 当字段名或表名过长或不易读时，可以使用别名来简化查询。
- 当查询中涉及多个表时，可以使用别名来更清楚地区分不同的表。
- 当查询中涉及到子查询时，可以使用别名来引用子查询的结果。

总之，别名可以让查询更简洁易读。

**基本语法：**

字段别名的语法如下

```sql
SELECT  <字段名> AS <字段别名>
FROM <表名>
[ WHERE <条件表达式> ];
```

表别名的语法如下：

```sql
SELECT <字段 1>, <字段 2>....
FROM <表名> AS <表别名>
[ WHERE <条件表达式> ];
```

**参考示例：**

1. 字段别名

    ```sql
    SELECT sid AS 学号,name AS 姓名,gender AS 性别,birthday AS 出生日期,address AS 地址 FROM student_info;
    ```

    ```sql
    +--------+-----------+--------+--------------+-----------+
    | 学号   | 姓名      | 性别   | 出生日期     | 地址      |
    +--------+-----------+--------+--------------+-----------+
    |   1001 | 张三      | 男     | 2000-12-13   | 上海      |
    |   1002 | 李四      | 女     | 2001-09-23   | 北京      |
    |   1003 | 王五      | 男     | 2005-11-11   | 广州      |
    |   1004 | 赵六      | NULL   | 2004-06-16   | NULL      |
    |   1005 | 小明      | 女     | 1999-03-03   | 广州      |
    |   1006 | 小红      | 女     | 2006-03-03   | 深圳      |
    |   1007 | 小蓝      | NULL   | 2003-04-28   | NULL      |
    |   1008 | 小绿      | 男     | 2008-12-21   | 深圳      |
    |   1009 | 沈剑心    | NULL   | 0700-02-02   | 稻香村    |
    |   1010 | 李忘生    | 男     | 0700-02-02   | NULL      |
    |   1011 | 谢云流    | 男     | NULL         | NULL      |
    +--------+-----------+--------+--------------+-----------+
    ```

2. 表别名

    表别名的作用主要体现在编写查询时。它可以更方便地引用表，特别是在查询中使用多个表时。

    将 `student_info` 表指定了一个别名 `s`，为 `student_score` 表指定了一个别名 `sc`。然后，在查询中使用这些别名来引用表。这样，查询就更简洁易读了。

    ```sql
    ELECT *  FROM student_info AS s, student_score AS sc WHERE s.sid = sc.sid;
    ```

    ```sql
    +------+-----------+--------+------------+-----------+------+---------+------+---------+
    | sid  | name      | gender | birthday   | address   | sid  | chinese | math | english |
    +------+-----------+--------+------------+-----------+------+---------+------+---------+
    | 1001 | 张三      | 男     | 2000-12-13 | 上海      | 1001 |      99 | 57.5 |      32 |
    | 1002 | 李四      | 女     | 2001-09-23 | 北京      | 1002 |      88 |   82 |      85 |
    | 1003 | 王五      | 男     | 2005-11-11 | 广州      | 1003 |      38 |   21 |     100 |
    | 1004 | 赵六      | NULL   | 2004-06-16 | NULL      | 1004 |      66 |   77 |      88 |
    | 1005 | 小明      | 女     | 1999-03-03 | 广州      | 1005 |      71 | 82.5 |      60 |
    | 1006 | 小红      | 女     | 2006-03-03 | 深圳      | 1006 |    61.5 |   59 |      65 |
    | 1007 | 小蓝      | NULL   | 2003-04-28 | NULL      | 1007 |      53 | NULL |      93 |
    | 1008 | 小绿      | 男     | 2008-12-21 | 深圳      | 1008 |      99 |   98 |      96 |
    | 1009 | 沈剑心    | NULL   | 0700-02-02 | 稻香村    | 1009 |      80 | NULL |    NULL |
    | 1010 | 李忘生    | 男     | 0700-02-02 | NULL      | 1010 |      91 | NULL |    NULL |
    | 1011 | 谢云流    | 男     | NULL       | NULL      | 1011 |      96 | NULL |    NULL |
    +------+-----------+--------+------------+-----------+------+---------+------+---------+
    ```

    `WHERE s.sid = sc.sid` 是一个条件表达式，用于指定从两个表中选择哪些行。

    在上面的示例中，从两个表 `student_info` 和 `student_score` 中选择数据。这两个表都有一个名为 `sid` 的列，表示学生的 ID。`WHERE s.sid = sc.sid` 条件指定只选择那些学生 ID 相同的行。这样，查询结果中每一行都包含来自两个表的匹配的数据。

    例如，`student_info` 表中有一行数据，其中学生 ID 为 1001，姓名为张三；并且 `student_score` 表中也有一行数据，其中学生 ID 为 1001，分数为 90。那么查询结果中将包含一行数据，其中学生 ID 为 1001，姓名为张三，分数为 90。

## 运算符查询

数据库中的表格结构确立后，表中的数据代表的意义已经确定。通过 MySQL 运算符进行运算，就可以获取到表结构以外的另一种数据。

例如，学生表中存在一个 brith 字段，这个字段表示学生的出生年份。而运用 MySQL 的运算符当前的年份减去学生的出生年份，那么得到的就是学生的实际年龄数据。

MySQL 支持 4 中运算符：

- 算术运算符

    |算数运算符|说明|
    |-|-|
    |`+`|加法运算。|
    |`-`|减法运算。|
    |`*`|乘法运算。|
    |`/`或`DIV`|除法运算，返回商。|
    |`%`或`MOD`|求余运算，返回余数。|

- 比较运算符

    |比较运算符|说明|
    |-|-|
    |`=`|等于。|
    |`<`和`<=`|小于和小于等于。|
    |`>`和`>=`|大于和大于等于。|
    |`<=>`|安全等于，两个操作码均 NULL 时，其所得值为 1；而当一个操作码为 NULL 时，其所得值为 0。|
    |`<>`或`!=`|不等于。|
    |`LEAST`|当有两个或多个参数时，返回最小值。|
    |`GREATEST`|当有两个或多个参数时，返回最大值。|
    |`BETWEEN <value1> AND <value2>`|判断一个值是否在两个值之间。|
    |`IS NULL`和`IS NOT NULL`|判断一个值是否为 NULL。|
    |`IN`和`NOT IN`|判断一个值是否在指定的列表中。|
    |`LIKE`|匹配模式。|
    |`REGEXP`|正则表达式匹配。|

- 逻辑运算符

    |逻辑运算符|说明|
    |-|-|
    |`NOT`或`!`|逻辑非。|
    |`AND`或`&&`|逻辑与。|
    |`OR`或`||`|逻辑或。|
    |`XOR`|逻辑异或。|

- 位运算符

    *位运算符是在二进制数上进行计算的运算符。位运算会将操作数变成二进制，进行位运算。然后再将计算结果从二进制数变回十进制数。*

    |位运算符|说明|
    |-|-|
    |`|`|按位或。|
    |`&`|按位与。|
    |`^`|按位异或。|
    |`<<`|按位左移。|
    |`>>`|按位右移。|
    |`~`|按位取反，反转所有比特。|

**参考示例：**

1. 算符运算符查询

   将所有学生的学号+1000

    ```sql
    SELECT sid + 1000 AS '新学号',name AS '名字' FROM student_info;
    ```

    ```sql
    +-----------+-----------+
    | 新学号    | 名字      |
    +-----------+-----------+
    |      2001 | 张三      |
    |      2002 | 李四      |
    |      2003 | 王五      |
    |      2004 | 赵六      |
    |      2005 | 小明      |
    |      2006 | 小红      |
    |      2007 | 小蓝      |
    |      2008 | 小绿      |
    |      2009 | 沈剑心    |
    |      2010 | 李忘生    |
    |      2011 | 谢云流    |
    +-----------+-----------+
    ```

    *在`SELECT`查询中使用算术运算符不会修改表中的数据。它只会在查询结果中计算新值，而不会影响表中存储的原始数据。*

2. 数值比较

    查询 2003 年之后出生的学生

    ```sql
    SELECT * FROM student_info WHERE birthday > '2003-12-31';
    ```

    ```sql
    +------+--------+--------+------------+---------+
    | sid  | name   | gender | birthday   | address |
    +------+--------+--------+------------+---------+
    | 1003 | 王五   | 男     | 2005-11-11 | 广州    |
    | 1004 | 赵六   | NULL   | 2004-06-16 | NULL    |
    | 1006 | 小红   | 女     | 2006-03-03 | 深圳    |
    | 1008 | 小绿   | 男     | 2008-12-21 | 深圳    |
    +------+--------+--------+------------+---------+
    ```

    查询 1998-03-03 年出生的学生

    ```sql
    SELECT * FROM student_info WHERE birthday = '1999-03-03';
    ```

    ```sql
    +------+--------+--------+------------+---------+
    | sid  | name   | gender | birthday   | address |
    +------+--------+--------+------------+---------+
    | 1005 | 小明   | 女     | 1999-03-03 | 广州    |
    +------+--------+--------+------------+---------+
    ```

    *使用日期值必须用引号括起来，以便 MySQL 将其识别为日期值。*

3. 字符比较

    查找性别为男的学生

    ```sql
    SELECT * FROM student_info WHERE gender = '男';
    ```

    ```sql
    +------+-----------+--------+------------+---------+
    | sid  | name      | gender | birthday   | address |
    +------+-----------+--------+------------+---------+
    | 1001 | 张三      | 男     | 2000-12-13 | 上海    |
    | 1003 | 王五      | 男     | 2005-11-11 | 广州    |
    | 1008 | 小绿      | 男     | 2008-12-21 | 深圳    |
    | 1010 | 李忘生    | 男     | 0700-02-02 | NULL    |
    | 1011 | 谢云流    | 男     | NULL       | NULL    |
    +------+-----------+--------+------------+---------+
    ```

    查找城市不为空的学生

    ```sql
    SELECT * FROM student_info WHERE address IS NOT NULL;
    ```

    ```sql
    +------+-----------+--------+------------+-----------+
    | sid  | name      | gender | birthday   | address   |
    +------+-----------+--------+------------+-----------+
    | 1001 | 张三      | 男     | 2000-12-13 | 上海      |
    | 1002 | 李四      | 女     | 2001-09-23 | 北京      |
    | 1003 | 王五      | 男     | 2005-11-11 | 广州      |
    | 1005 | 小明      | 女     | 1999-03-03 | 广州      |
    | 1006 | 小红      | 女     | 2006-03-03 | 深圳      |
    | 1008 | 小绿      | 男     | 2008-12-21 | 深圳      |
    | 1009 | 沈剑心    | NULL   | 0700-02-02 | 稻香村    |
    +------+-----------+--------+------------+-----------+
    ```

4. 范围匹配

    查看学号是 1001 或 1003 或 10055 学生

    ```sql
    SELECT * FROM student_info WHERE sid in (1001,1003,1005);
    ```

    ```sql
    +------+--------+--------+------------+---------+
    | sid  | name   | gender | birthday   | address |
    +------+--------+--------+------------+---------+
    | 1001 | 张三   | 男     | 2000-12-13 | 上海    |
    | 1003 | 王五   | 男     | 2005-11-11 | 广州    |
    | 1005 | 小明   | 女     | 1999-03-03 | 广州    |
    +------+--------+--------+------------+---------+
    ```

    查看地址为上海或北京的学生

    ```sql
    SELECT * FROM student_info WHERE address in ('上海','北京');
    ```

    ```sql
    +------+--------+--------+------------+---------+
    | sid  | name   | gender | birthday   | address |
    +------+--------+--------+------------+---------+
    | 1001 | 张三   | 男     | 2000-12-13 | 上海    |
    | 1002 | 李四   | 女     | 2001-09-23 | 北京    |
    +------+--------+--------+------------+---------+
    ```

    查看 2008 年出生的学生

    ```sql
    SELECT * FROM student_info WHERE birthday BETWEEN '2008-01-01' and '2008-12-31';
    ```

    ```sql
    +------+--------+--------+------------+---------+
    | sid  | name   | gender | birthday   | address |
    +------+--------+--------+------------+---------+
    | 1008 | 小绿   | 男     | 2008-12-21 | 深圳    |
    +------+--------+--------+------------+---------+
    ```

5. 模糊匹配

    查看名字是小开头的学生

    ```sql
    SELECT * FROM student_info WHERE name LIKE '小%';
    ```

    ```sql
    +------+--------+--------+------------+---------+
    | sid  | name   | gender | birthday   | address |
    +------+--------+--------+------------+---------+
    | 1005 | 小明   | 女     | 1999-03-03 | 广州    |
    | 1006 | 小红   | 女     | 2006-03-03 | 深圳    |
    | 1007 | 小蓝   | NULL   | 2003-04-28 | NULL    |
    | 1008 | 小绿   | 男     | 2008-12-21 | 深圳    |
    +------+--------+--------+------------+---------+
    ```

    查看姓名至少 3 个字符的学生

    ```sql
    SELECT * FROM student_info WHERE name LIKE '___%';
    ```

    ```sql
    +------+-----------+--------+------------+-----------+
    | sid  | name      | gender | birthday   | address   |
    +------+-----------+--------+------------+-----------+
    | 1009 | 沈剑心    | NULL   | 0700-02-02 | 稻香村    |
    | 1010 | 李忘生    | 男     | 0700-02-02 | NULL      |
    | 1011 | 谢云流    | 男     | NULL       | NULL      |
    +------+-----------+--------+------------+-----------+
    ```

6. 正则匹配

    查找出生日期是 2005 年 11 月出生的学生

    ```sql
    SELECT * FROM student_info WHERE birthday REGEXP '^2005-11-';
    ```

    ```sql
    +------+--------+--------+------------+---------+
    | sid  | name   | gender | birthday   | address |
    +------+--------+--------+------------+---------+
    | 1003 | 王五   | 男     | 2005-11-11 | 广州    |
    +------+--------+--------+------------+---------+
    ```

    查找出生日期是 2005 年或 2006 年的学生

    ```sql
    SELECT * FROM student_info WHERE birthday REGEXP '^2005|^2006';
    ```

    ```sql
    +------+--------+--------+------------+---------+
    | sid  | name   | gender | birthday   | address |
    +------+--------+--------+------------+---------+
    | 1003 | 王五   | 男     | 2005-11-11 | 广州    |
    | 1006 | 小红   | 女     | 2006-03-03 | 深圳    |
    +------+--------+--------+------------+---------+
    ```

7. 逻辑比较

    查看性别为女并且地址是深圳的学生

    ```sql
    SELECT * FROM student_info WHERE gender='女' and address='深圳';
    ```

    ```sql
    +------+--------+--------+------------+---------+
    | sid  | name   | gender | birthday   | address |
    +------+--------+--------+------------+---------+
    | 1002 | 李四   | 女     | 2001-09-23 | 北京    |
    +------+--------+--------+------------+---------+
    ```

    查看性别是男或者出生日期是 2000 年的学生

    ```sql
    SELECT * FROM student_info WHERE gender='男' or birthday REGEXP '^2000';
    ```

    ```sql
    +------+--------+--------+------------+---------+
    | sid  | name   | gender | birthday   | address |
    +------+--------+--------+------------+---------+
    | 1001 | 张三   | 男     | 2000-12-13 | 上海    |
    +------+--------+--------+------------+---------+
    ```

    注意，如果既有`and`又有`or`，优先匹配`and`

    ```sql
    SELECT * FROM student_info WHERE gender='女' or birthday REGEXP '^2' and address IS NULL;
    ```

    ```sql
    +------+--------+--------+------------+---------+
    | sid  | name   | gender | birthday   | address |
    +------+--------+--------+------------+---------+
    | 1002 | 李四   | 女     | 2001-09-23 | 北京    |
    | 1004 | 赵六   | NULL   | 2004-06-16 | NULL    |
    | 1005 | 小明   | 女     | 1999-03-03 | 广州    |
    | 1006 | 小红   | 女     | 2006-03-03 | 深圳    |
    | 1007 | 小蓝   | NULL   | 2003-04-28 | NULL    |
    +------+--------+--------+------------+---------+
    ```

    可以使用`( )`，使其`or`变为优先匹配

    ```sql
    SELECT * FROM student_info WHERE (gender='女' or birthday REGEXP '^2') and address IS NULL;
    ```

    ```sql
    +------+--------+--------+------------+---------+
    | sid  | name   | gender | birthday   | address |
    +------+--------+--------+------------+---------+
    | 1004 | 赵六   | NULL   | 2004-06-16 | NULL    |
    | 1007 | 小蓝   | NULL   | 2003-04-28 | NULL    |
    +------+--------+--------+------------+---------+
    ```

## 排序查询

在 MySQL 中，可以使用`ORDER BY`子句对查询结果进行排序。`ORDER BY`子句通常位于`SELECT`语句的末尾，用于指定排序依据的列和排序顺序（升序或降序）。

**基本语法：**

```sql
SELECT <字段 1>,<字段 2>…… FROM <表名>
ORDER BY <字段 1> [ ASC | DESC ] , <字段 2 > [ ASC | DESC ];
```

- ASC 表示升序，DESC 表示降序，如果不写默认升序。
- `ORDER BY`用于子句中可以支持单个字段、多个字段、表达式、函数、别名。
- `ORDER BY`子句，放在查询语句的最后，LIMIT 子句除外。

**参考示例：**

1. 使用出生日期排序

    如果不指定，则默认使 ASC 升序排序

    ```sql
    SELECT * FROM student_info ORDER BY birthday;
    ```

    ```sql
    +------+-----------+--------+------------+-----------+
    | sid  | name      | gender | birthday   | address   |
    +------+-----------+--------+------------+-----------+
    | 1011 | 谢云流    | 男     | NULL       | NULL      |
    | 1010 | 李忘生    | 男     | 0700-02-02 | NULL      |
    | 1009 | 沈剑心    | NULL   | 0700-02-02 | 稻香村    |
    | 1005 | 小明      | 女     | 1999-03-03 | 广州      |
    | 1001 | 张三      | 男     | 2000-12-13 | 上海      |
    | 1002 | 李四      | 女     | 2001-09-23 | 北京      |
    | 1007 | 小蓝      | NULL   | 2003-04-28 | NULL      |
    | 1004 | 赵六      | NULL   | 2004-06-16 | NULL      |
    | 1003 | 王五      | 男     | 2005-11-11 | 广州      |
    | 1006 | 小红      | 女     | 2006-03-03 | 深圳      |
    | 1008 | 小绿      | 男     | 2008-12-21 | 深圳      |
    +------+-----------+--------+------------+-----------+
    ```

    指定降序排序

    ```sql
    SELECT * FROM student_info ORDER BY birthday DESC;
    ```

    ```sql
    +------+-----------+--------+------------+-----------+
    | sid  | name      | gender | birthday   | address   |
    +------+-----------+--------+------------+-----------+
    | 1008 | 小绿      | 男     | 2008-12-21 | 深圳      |
    | 1006 | 小红      | 女     | 2006-03-03 | 深圳      |
    | 1003 | 王五      | 男     | 2005-11-11 | 广州      |
    | 1004 | 赵六      | NULL   | 2004-06-16 | NULL      |
    | 1007 | 小蓝      | NULL   | 2003-04-28 | NULL      |
    | 1002 | 李四      | 女     | 2001-09-23 | 北京      |
    | 1001 | 张三      | 男     | 2000-12-13 | 上海      |
    | 1005 | 小明      | 女     | 1999-03-03 | 广州      |
    | 1009 | 沈剑心    | NULL   | 0700-02-02 | 稻香村    |
    | 1010 | 李忘生    | 男     | 0700-02-02 | NULL      |
    | 1011 | 谢云流    | 男     | NULL       | NULL      |
    +------+-----------+--------+------------+-----------+
    ```

2. 在出生日期排序（升序）的基础上，以学号排序（降序）

    ```sql
    SELECT * FROM student_info ORDER BY birthday,sid DESC;
    ```

    ```sql
    +------+-----------+--------+------------+-----------+
    | sid  | name      | gender | birthday   | address   |
    +------+-----------+--------+------------+-----------+
    | 1011 | 谢云流    | 男     | NULL       | NULL      |
    | 1010 | 李忘生    | 男     | 0700-02-02 | NULL      |
    | 1009 | 沈剑心    | NULL   | 0700-02-02 | 稻香村    |
    | 1005 | 小明      | 女     | 1999-03-03 | 广州      |
    | 1001 | 张三      | 男     | 2000-12-13 | 上海      |
    | 1002 | 李四      | 女     | 2001-09-23 | 北京      |
    | 1007 | 小蓝      | NULL   | 2003-04-28 | NULL      |
    | 1004 | 赵六      | NULL   | 2004-06-16 | NULL      |
    | 1003 | 王五      | 男     | 2005-11-11 | 广州      |
    | 1006 | 小红      | 女     | 2006-03-03 | 深圳      |
    | 1008 | 小绿      | 男     | 2008-12-21 | 深圳      |
    +------+-----------+--------+------------+-----------+
    ```

    当出生日期相同时，就会按照学号降序进行排序

3. 去重排序

    将 birthday 重复的值去除，并按照 birthday 的值进行升序排序。

    ```sql
    SELECT DISTINCT birthday FROM student_info ORDER BY birthday;
    ```

    ```sql
    +------------+
    | birthday   |
    +------------+
    | NULL       |
    | 0700-02-02 |
    | 1999-03-03 |
    | 2000-12-13 |
    | 2001-09-23 |
    | 2003-04-28 |
    | 2004-06-16 |
    | 2005-11-11 |
    | 2006-03-03 |
    | 2008-12-21 |
    +------------+
    ```

## 聚合查询

MySQL 聚合查询是指使用聚合函数对多个值进行计算并返回单个值的查询。

之前进行的查询都是横向查询，它们都是根据一行一行的进行判断，而是用聚合函数查询是从纵向查询，它是对一列的值进行计算，然后返回一个单一的值；另外聚合查询会忽略空值。

|聚合函数|作用|
|-|-|
|`COUNT()`|统计指定列不为 NULL 的记录行数。|
|`AVG()`|计算指定列的平均值，如果指定类型不是数据类型，那么计算结果为 0。|
|`SUM()`|计算指定列的数值和，如果指定类型不是数据类型，那么计算结果为 0。|
|`MAX()`|计算指定列的最大值，如果指定类型不是数据类型，那么使用字符串排序运算。|
|`MIN()`|计算指定列的最小值，如果指定类型不是数据类型，那么使用字符串排序运算。|

- 括号中的值 `( )` 可以替换为任何常量或列名，结果都是一样的。

这些聚合函数通常与`GROUP BY`子句一起使用，以对数据进行分组并对每组数据进行计算。例如，可以使用`SELECT AVG(price) FROM products GROUP BY category;`来计算每个产品类别的平均价格。

方便演示再创建一个表，存放学生的成绩：

```sql
USE school; -- 进入库中
CREATE TABLE IF NOT EXISTS student_score( -- 创建学生成绩表
    sid INT PRIMARY KEY auto_increment, -- 学号
    chinese FLOAT, -- 语文
    math FLOAT, -- 数学
    english FLOAT -- 英语
)AUTO_INCREMENT = 1001;
```

```sql
INSERT INTO student_score VALUES(NULL,'99','57.5','32');
INSERT INTO student_score VALUES(NULL,'88','82','85');
INSERT INTO student_score VALUES(NULL,'38','21','100');
INSERT INTO student_score VALUES(NULL,'66','77','88');

INSERT INTO student_score VALUES(NULL,'71','82.5','60');
INSERT INTO student_score VALUES(NULL,'61.5','59','65');
INSERT INTO student_score VALUES(NULL,'53',NULL,'93');
INSERT INTO student_score VALUES(NULL,'99','98','96');

INSERT INTO student_score VALUES(NULL,'80',NULL,NULL);
INSERT INTO student_score VALUES(NULL,'91',NULL,NULL);
INSERT INTO student_score VALUES(NULL,'96',NULL,NULL);
```

```sql
SELECT * FROM student_score;
```

```sql
+------+---------+------+---------+
| sid  | chinese | math | english |
+------+---------+------+---------+
| 1001 |      99 | 57.5 |      32 |
| 1002 |      88 |   82 |      85 |
| 1003 |      38 |   21 |     100 |
| 1004 |      66 |   77 |      88 |
| 1005 |      71 | 82.5 |      60 |
| 1006 |    61.5 |   59 |      65 |
| 1007 |      53 | NULL |      93 |
| 1008 |      99 |   98 |      96 |
| 1009 |      80 | NULL |    NULL |
| 1010 |      91 | NULL |    NULL |
| 1011 |      96 | NULL |    NULL |
+------+---------+------+---------+
```

**参考示例：**

1. 查询学生的总条数

    ```sql
    SELECT COUNT(sid) FROM student_score;
    ```

    ```sql
    +------------+
    | COUNT(sid) |
    +------------+
    |         11 |
    +------------+
    ```

    `*`也可以求出所有不为空的行

    ```sql
    SELECT COUNT(*) FROM student_score;
    ```

    ```sql
    +----------+
    | COUNT(*) |
    +----------+
    |       11 |
    +----------+
    ```

2. 查询英文成绩大于 60 的总条数

    ```sql
    SELECT COUNT(english) FROM student_score WHERE english >= 60;
    ```

    ```sql
    +----------------+
    | COUNT(english) |
    +----------------+
    |              7 |
    +----------------+
    ```

3. 查询语文成绩所有分数的综合

    ```sql
    SELECT SUM(chinese) FROM student_score;
    ```

    ```sql
    +--------------+
    | SUM(chinese) |
    +--------------+
    |        842.5 |
    +--------------+
    ```

4. 查询数学成绩最高分

    ```sql
    SELECT MAX(math) FROM student_score;
    ```

    ```sql
    +-----------+
    | MAX(math) |
    +-----------+
    |        98 |
    +-----------+
    ```

5. 查询语文成绩最高分和最低分

    ```sql
    SELECT MAX(chinese),MIN(chinese) FROM student_score;
    ```

    ```sql
    +--------------+--------------+
    | MAX(chinese) | MIN(chinese) |
    +--------------+--------------+
    |           99 |           38 |
    +--------------+--------------+
    ```

6. 查询英文成绩的平均值

    ```sql
    SELECT AVG(english) FROM student_score;
    ```

    ```sql
    +--------------+
    | AVG(english) |
    +--------------+
    |       77.375 |
    +--------------+
    ```

**聚合查询对 NULL 值的处理：**

1. COUNT 函数对 NULL 值的处理：如果 COUNT 函数的参数为 `*`，则统计记录的个数，而如果参数为某个字段，不统计含 NULL 值的记录个数。
2. SUM 和 AVG 函数对 NULL 值的处理：这两个函数忽略 NULL 值的存在。
3. MAX 和 MIN 函数对 NULL 值的处理：MAX 和 MIN 两个函数同样忽略 NULL 值的存在。

```sql
mysql> SELECT COUNT(*),COUNT(chinese),COUNT(math) FROM student_score;
+----------+----------------+-------------+
| COUNT(*) | COUNT(chinese) | COUNT(math) |
+----------+----------------+-------------+
|       11 |             11 |           7 |
+----------+----------------+-------------+
```

## 分组查询

在 MySQL 中，可以使用 `GROUP BY` 子句对查询结果进行分组。`GROUP BY` 子句通常与聚合函数（如 `SUM`、`AVG`、`COUNT` 等）一起使用，用于对分组后的数据进行计算。

**基本语法：**

```sql
SELECT <字段 1>,<字段 2>…… FROM <表名> GROUP BY <分组字段> HAVING [分组条件];
```

- 如果要进行分组的话，则 SELECT 子语句之后，只能出现分组的字段和统计函数，其他的字段不能出现。

**参考示例：**

1. 统计学生所属城市的数量

    ```sql
    SELECT address,COUNT(*) FROM student_info GROUP BY address;
    ```

    ```sql
    +-----------+----------+
    | address   | COUNT(*) |
    +-----------+----------+
    | 上海      |        1 |
    | 北京      |        1 |
    | 广州      |        2 |
    | NULL      |        4 |
    | 深圳      |        2 |
    | 稻香村    |        1 |
    +-----------+----------+
    ```

2. 分组之后进行的条件筛选

    ```sql
    SELECT address,COUNT(*) FROM student_info GROUP BY address having COUNT(*) > 1;
    ```

    ```sql
    +---------+----------+
    | address | COUNT(*) |
    +---------+----------+
    | 广州    |        2 |
    | NULL    |        4 |
    | 深圳    |        2 |
    +---------+----------+
    ```

3. 将分组后的条件筛选再进行排序

    ```sql
    SELECT
        address,COUNT(*) 
    FROM 
        student_info 
    GROUP BY 
        address having COUNT(*) > 1 
    ORDER BY 
        COUNT(*);
    ```

    ```sql
    +---------+----------+
    | address | COUNT(*) |
    +---------+----------+
    | 广州    |        2 |
    | 深圳    |        2 |
    | NULL    |        4 |
    +---------+----------+
    ```

## 分页查询

分页查询是一种将所有数据分段展示给用户的技术。用户每次看到的不是全部数据，而是其中的一部分。如果在其中没有找到自己想要的内容，用户可以通过指定页码或翻页的方式转换可见内容，直到找到自己想要的内容为止。这和阅读书籍很类似。

当需要从数据库查询的表有上万条记录的时候，一次性查询所有结果会变得很慢，特别是随着数据量的增加特别明显，这时需要使用分页查询。

分页查询在项目开发中常见，由于数据量很大，显示屏长度有限，因此对数据需要采取分页显示的方式。这样，用户每次看到的不是全部数据，而是其中的一部分。例如，如果数据共有 30 条，每页显示 5 条，那么第一页显示 1~5 条，第二页显示 6~10 条，以此类推。这样可以提高查询性能并节省网络流量。

MySQL 中通过 `LIMIT` 语句来进行分页查询。

**基本语法：**

```sql
SELECT <字段 1>,<字段 2>…… FROM <表名> LIMIT [offset,] row_count;
```

- `offset` 是可选的，表示从哪一行开始返回数据。如果省略了 `offset`，则默认从第一行开始返回数据。
- `row_count` 表示返回的行数。

**参考示例：**

1. 查询表中的前 5 行数据

    ```sql
    SELECT * FROM student_info limit 5;
    ```

    ```sql
    +------+--------+--------+------------+---------+
    | sid  | name   | gender | birthday   | address |
    +------+--------+--------+------------+---------+
    | 1001 | 张三   | 男     | 2000-12-13 | 上海    |
    | 1002 | 李四   | 女     | 2001-09-23 | 北京    |
    | 1003 | 王五   | 男     | 2005-11-11 | 广州    |
    | 1004 | 赵六   | NULL   | 2004-06-16 | NULL    |
    | 1005 | 小明   | 女     | 1999-03-03 | 广州    |
    +------+--------+--------+------------+---------+
    ```

2. 查询表中的第 6 到第 10 行数据

    ```sql
    SELECT * FROM student_info LIMIT 5, 5;
    ```

    ```sql
    +------+-----------+--------+------------+-----------+
    | sid  | name      | gender | birthday   | address   |
    +------+-----------+--------+------------+-----------+
    | 1006 | 小红      | 女     | 2006-03-03 | 深圳      |
    | 1007 | 小蓝      | NULL   | 2003-04-28 | NULL      |
    | 1008 | 小绿      | 男     | 2008-12-21 | 深圳      |
    | 1009 | 沈剑心    | NULL   | 0700-02-02 | 稻香村    |
    | 1010 | 李忘生    | 男     | 0700-02-02 | NULL      |
    +------+-----------+--------+------------+-----------+
    ```

    `offset` 为 5，表示从第 6 行开始返回数据（注意，行号从 0 开始计算），`row_count` 为 5，表示返回 5 行数据。

3. 查询表中的最后一行数据

    ```sql
    SELECT * FROM table_name ORDER BY id DESC LIMIT 1;
    ```

    ```sql
    +------+-----------+--------+----------+---------+
    | sid  | name      | gender | birthday | address |
    +------+-----------+--------+----------+---------+
    | 1011 | 谢云流    | 男     | NULL     | NULL    |
    +------+-----------+--------+----------+---------+
    ```

## 查询导出

MySQL 的 `INSERT INTO SELECT` 语句可以从**一个表中复制数据并将其插入到另一个表中**。这可以用于将数据从一个表复制到另一个表，或者在两个表之间转移数据。注意，`INSERT INTO SELECT` 语句要求源表和目标表中的数据类型匹配，且另一个表必须存在。

**基本语法：**

```sql
INSERT INTO <表名 2> （字段 1, 字段 2, 字段 3, ...)
SELECT 字段 1, 字段 2, 字段 3, ... FROM <表名 1> WHERE 表达式 ;
```

```sql
INSERT INTO <表名 2>
SELECT * FROM <表名 1> WHERE 表达式 ;
```

参考示例：

查看原表数据类型：

```sql
DESC student_info;
```

```mysql
+----------+-------------+------+-----+---------+----------------+
| Field    | Type        | Null | Key | Default | Extra          |
+----------+-------------+------+-----+---------+----------------+
| sid      | int         | NO   | PRI | NULL    | auto_increment |
| name     | varchar(20) | YES  |     | NULL    |                |
| gender   | varchar(20) | YES  |     | NULL    |                |
| birthday | date        | YES  |     | NULL    |                |
| address  | varchar(20) | YES  |     | NULL    |                |
+----------+-------------+------+-----+---------+----------------+
```

创建一个和原表数据类型一致的新表

```sql
CREATE TABLE student_info_db(
    sid int,
    name varchar(20),
    address varchar(20)
);
```

然后将查询的数据进行导出

```sql
INSERT INTO student_info_db(sid,name,address) 
SELECT sid,name,address FROM student_info;
```

最后查看新表

```sql
SELECT * FROM student_info_db;
```

```sql
+------+-----------+-----------+
| sid  | name      | address   |
+------+-----------+-----------+
| 1001 | 张三      | 上海      |
| 1002 | 李四      | 北京      |
| 1003 | 王五      | 广州      |
| 1004 | 赵六      | NULL      |
| 1005 | 小明      | 广州      |
| 1006 | 小红      | 深圳      |
| 1007 | 小蓝      | NULL      |
| 1008 | 小绿      | 深圳      |
| 1009 | 沈剑心    | 稻香村    |
| 1010 | 李忘生    | NULL      |
| 1011 | 谢云流    | NULL      |
+------+-----------+-----------+
```

同时还可以过滤，例如：

```sql
INSERT INTO student_info_db(sid,name,address) 
SELECT sid,name,address FROM student_info WHERE name LIKE '___%';
```

```sql
+------+-----------+-----------+
| sid  | name      | address   |
+------+-----------+-----------+
…………
| 1009 | 沈剑心    | 稻香村    |
| 1010 | 李忘生    | NULL      |
| 1011 | 谢云流    | NULL      |
+------+-----------+-----------+
```
